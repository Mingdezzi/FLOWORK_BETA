<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOWORK</title>
    
    <link rel="icon" href="{{ url_for('static', filename='symbol.png') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/journal/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
</head>
<body data-update-status-url="{{ url_for('api.api_update_order_status') }}">
    <div class="container my-4">
        
        {% include '_header.html' %}

        {% include '_navigation.html' %}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert {{ 'alert-success' if category == 'success' else ('alert-info' if category == 'info' else ('alert-warning' if category == 'warning' else 'alert-danger')) }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="mb-0"><i class="bi bi-clock-history me-2"></i>진행 중인 주문 ({{ pending_orders|length }}건)</h2>
                <a href="{{ url_for('ui.new_order') }}" class="btn btn-primary">
                    <i class="bi bi-plus-lg me-1"></i> 신규 주문 등록
                </a>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush" id="pending-order-list">
                    {% for order in pending_orders %}
                    <li class="list-group-item order-list-item-stacked">
                        <div class="order-info-area" onclick="window.location='{{ url_for('ui.order_detail', order_id=order.id) }}';">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong class="main-info">{{ order.customer_name }}</strong>
                                    <small class="sub-info">{{ order.customer_phone }}</small>
                                </div>
                                <span class="badge bg-light text-dark order-date-badge">
                                    {{ order.created_at.strftime('%Y-%m-%d') }}
                                </span>
                            </div>
                            <div class="order-details-grid order-details-grid-2col mt-2">
                                <div>
                                    <small class="text-muted d-block">상품</small>
                                    <div>{{ order.product_name }}</div>
                                    <div class="sub-info">{{ order.product_number }}</div>
                                </div>
                                <div>
                                    <small class="text-muted d-block">옵션</small>
                                    <div>{{ order.color }} / {{ order.size }}</div>
                                </div>
                                </div>
                        </div>

                        <div class="d-flex align-items-center mt-2">
                            <a href="tel:{{ order.customer_phone.replace('-', '') }}" class="btn btn-sm btn-outline-success ms-0 py-0 px-2" title="전화걸기">
                                <i class="bi bi-telephone-fill me-1"></i> 전화
                            </a>
                            <a href="{{ order.sms_link }}" class="btn btn-sm btn-outline-primary ms-2 py-0 px-2" title="문자보내기">
                                <i class="bi bi-chat-dots-fill me-1"></i> 문자
                            </a>
                        </div>
                        
                        <div class="order-status-grid mt-2">
                            <button type="button" 
                                    class="btn btn-sm status-btn status-1 {{ 'active' if order.order_status == '고객주문' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="고객주문">
                                고객주문
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-2 {{ 'active' if order.order_status == '주문등록' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="주문등록">
                                주문등록
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-3 {{ 'active' if order.order_status == '매장도착' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="매장도착">
                                매장도착
                            </button>
                            {% if order.reception_method == '택배수령' %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-4 {{ 'active' if order.order_status == '택배 발송' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="택배 발송">
                                택배 발송
                            </button>
                            {% else %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-4 {{ 'active' if order.order_status == '고객연락' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="고객연락">
                                고객연락
                            </button>
                            {% endif %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-5 {{ 'active' if order.order_status == '완료' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="완료">
                                완료
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-6 {{ 'active' if order.order_status == '기타' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="기타">
                                기타
                            </button>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted p-3">
                        진행 중인 주문이 없습니다.
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="mb-0"><i class="bi bi-calendar-month me-2"></i>월별 주문 목록</h2>
            </div>
            <div class="card-body">
                <form method="GET" action="{{ url_for('ui.order_list') }}" class="row g-2 mb-3">
                    <div class="col-auto">
                        <select name="year" class="form-select form-select-sm">
                            {% for year in year_list %}
                            <option value="{{ year }}" {{ 'selected' if year == selected_year else '' }}>{{ year }}년</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-auto">
                        <select name="month" class="form-select form-select-sm">
                            {% for month in month_list %}
                            <option value="{{ month }}" {{ 'selected' if month == selected_month else '' }}>{{ month }}월</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-search me-1"></i> 조회
                        </button>
                    </div>
                </form>
            
                <h4 class="mb-3">{{ selected_year }}년 {{ selected_month }}월 주문 ({{ monthly_orders|length }}건)</h4>
                <ul class="list-group list-group-flush" id="monthly-order-list">
                    {% for order in monthly_orders %}
                    <li class="list-group-item order-list-item-stacked">
                        <div class="order-info-area" onclick="window.location='{{ url_for('ui.order_detail', order_id=order.id) }}';">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong class="main-info">{{ order.customer_name }}</strong>
                                    <small class="sub-info">{{ order.customer_phone }}</small>
                                </div>
                                <span class="badge bg-light text-dark order-date-badge">
                                    {{ order.created_at.strftime('%Y-%m-%d') }}
                                </span>
                            </div>
                            <div class="order-details-grid order-details-grid-2col mt-2">
                                <div>
                                    <small class="text-muted d-block">상품</small>
                                    <div>{{ order.product_name }}</div>
                                    <div class="sub-info">{{ order.product_number }}</div>
                                </div>
                                <div>
                                    <small class="text-muted d-block">옵션</small>
                                    <div>{{ order.color }} / {{ order.size }}</div>
                                </div>
                                </div>
                        </div>
                        
                        <div class="d-flex align-items-center mt-2">
                            <a href="tel:{{ order.customer_phone.replace('-', '') }}" class="btn btn-sm btn-outline-success ms-0 py-0 px-2" title="전화걸기">
                                <i class="bi bi-telephone-fill me-1"></i> 전화
                            </a>
                            <a href="{{ order.sms_link }}" class="btn btn-sm btn-outline-primary ms-2 py-0 px-2" title="문자보내기">
                                <i class="bi bi-chat-dots-fill me-1"></i> 문자
                            </a>
                        </div>
                        
                        <div class="order-status-grid mt-2">
                           <button type="button" 
                                    class="btn btn-sm status-btn status-1 {{ 'active' if order.order_status == '고객주문' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="고객주문">
                                고객주문
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-2 {{ 'active' if order.order_status == '주문등록' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="주문등록">
                                주문등록
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-3 {{ 'active' if order.order_status == '매장도착' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="매장도착">
                                매장도착
                            </button>
                            {% if order.reception_method == '택배수령' %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-4 {{ 'active' if order.order_status == '택배 발송' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="택배 발송">
                                택배 발송
                            </button>
                            {% else %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-4 {{ 'active' if order.order_status == '고객연락' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="고객연락">
                                고객연락
                            </button>
                            {% endif %}
                            <button type="button" 
                                    class="btn btn-sm status-btn status-5 {{ 'active' if order.order_status == '완료' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="완료">
                                완료
                            </button>
                            <button type="button" 
                                    class="btn btn-sm status-btn status-6 {{ 'active' if order.order_status == '기타' else '' }}"
                                    data-order-id="{{ order.id }}" data-new-status="기타">
                                기타
                            </button>
                        </div>
                    </li>
                    {% else %}
                    <li class="list-group-item text-center text-muted p-3">
                        해당 월에 등록된 주문이 없습니다.
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script src="{{ url_for('static', filename='js/order_list.js') }}" defer></script>
</body>
</html>